"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[826],{148:function(e,t,r){var n=r(344),o=r.n(n);function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){u=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=35.67822,u=139.74901,l=14,s=[0,-32],f=document.querySelector(".ad-form"),d=document.querySelector(".map__filters"),v=f.querySelectorAll("fieldset"),p=o().icon({iconUrl:"img/leaflet-img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),y=o().icon({iconUrl:"img/leaflet-img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});!function(){var e,t=a(v);try{for(t.s();!(e=t.n()).done;){e.value.setAttribute("disabled","")}}catch(e){t.e(e)}finally{t.f()}var r,n=a(d.children);try{for(n.s();!(r=n.n()).done;){r.value.setAttribute("disabled","")}}catch(e){n.e(e)}finally{n.f()}f.classList.add("ad-form--disabled"),d.classList.add("map__filters--disabled")}();var h=o().map("map-canvas").once("load",(function(){f.classList.remove("ad-form--disabled");var e,t=a(v);try{for(t.s();!(e=t.n()).done;){e.value.removeAttribute("disabled","")}}catch(e){t.e(e)}finally{t.f()}})).setView({lat:c,lng:u},l);o().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(h);var m=o().marker([c,u],{icon:p,draggable:!0,autoPan:!0,autoPanPadding:[200,150],autoPanSpeed:7}).addTo(h);m.on("mouseover",(function(e){e.target.dragging.enable()})),m.on("drag",(function(){var e,t,r=m.getLatLng().lat,n=m.getLatLng().lng;e=r,t=n,C.value="".concat(e.toFixed(L),", ").concat(t.toFixed(L))}));var g=(new(o().LayerGroup)).addTo(h);function S(e){g.clearLayers(),e.forEach((function(e,t){o().marker([+t.lat,+t.lng],{icon:y}).bindPopup(o().popup({content:e.innerHTML,offset:s})).addTo(g)}))}function b(e){e.preventDefault(),e.target.classList.contains("active-hover")&&e.target.classList.remove("active-hover")}function w(e,t){e.addEventListener("dragover",(function(e){!function(e){e.preventDefault(),e.target.classList.contains("active-hover")||e.target.classList.add("active-hover")}(e)})),e.addEventListener("dragleave",(function(e){b(e)})),e.addEventListener("drop",(function(e){t.files=e.dataTransfer.files,t.dispatchEvent(new Event("change")),b(e)}))}function _(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var L=5,E=["jpg","jpeg","png","gif","webp","svg"],A=document.querySelector(".ad-form"),k=document.querySelector(".map__filters"),C=A.querySelector("#address"),j=document.querySelector("body"),x=document.querySelector("#success").content.querySelector(".success"),O=document.querySelector("#error").content.querySelector(".error"),T=A.querySelector("#type"),V=A.querySelector("#price"),M=A.querySelector("#timein"),I=A.querySelector("#timeout"),P=A.querySelector(".ad-form__element--time"),U=A.querySelector("#room_number"),W=A.querySelector("#capacity"),$=A.querySelector("#avatar"),D=A.querySelector("#images"),z=A.querySelector(".ad-form__photo"),F=A.querySelector(".ad-form-header__preview"),G=A.querySelector(".ad-form__drop-zone"),N=A.querySelector(".ad-form-header__drop-zone");function R(e,t,r){"Escape"===e.key&&(t.remove(),j.removeEventListener("keydown",r))}function B(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild)}var H={bungalow:0,flat:1e3,hotel:3e3,house:5e3,palace:1e4,getMatchedValue:function(e){if(e)for(var t=0,r=Object.keys(this);t<r.length;t++){var n=r[t];if(n===e)return this[n]}return null}};function J(){var e=+W.value>+U.value&&0!=+W.value,t=100==+U.value&&0!=+W.value,r=100!=+U.value&&0==+W.value;t?W.setCustomValidity("Допустимо: не для гостей"):r?U.setCustomValidity("Допустимое количество комнат не менее 100"):e?W.setCustomValidity("Допустимо: число гостей не более ".concat(U.value)):(W.setCustomValidity(""),U.setCustomValidity("")),W.reportValidity(),U.reportValidity()}function K(e){var t=O.cloneNode(!0);t.querySelector(".error__message").textContent=e,j.appendChild(t),t.querySelector(".error__button").addEventListener("click",(function(){return t.remove()}),{once:!0}),j.addEventListener("keydown",(function e(r){R(r,t,e)}))}function Q(e,t){var r=e.files;if(r.length>6)return B(t),e.value=null,K("Добавьте не более ".concat(6," фотографий.")),!1;if(!e.matches("[multiple]")&&r.length>1)return B(t),e.value=null,K("Добавьте только одно изображение."),!1;var n,o=_(r);try{var a,i=function(){var r=n.value;if(!E.some((function(e){return r.name.endsWith(e)})))return B(t),e.value=null,K("Выберите изображения формата JPG, PNG, BMP, GIF, WEBP, SVG."),{v:!1}};for(o.s();!(n=o.n()).done;)if(a=i())return a.v}catch(e){o.e(e)}finally{o.f()}return!0}function X(e,t){var r=e.files;B(t);var n,o=_(r);try{var a=function(){var e=n.value,r=document.createElement("img");r.style.maxWidth="70px",r.style.objectFit="contain",r.src=URL.createObjectURL(e),r.addEventListener("load",(function(){URL.revokeObjectURL(r.src)}),{once:!0}),t.appendChild(r)};for(o.s();!(n=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}}function Y(){j.appendChild(x),A.reset(),k.reset(),B(F),B(z),m.setLatLng([c,u]),h.setView({lat:c,lng:u},l),j.addEventListener("click",(function(){return x.remove()}),{once:!0}),j.addEventListener("keydown",(function e(t){R(t,x,e)}))}function Z(){j.appendChild(O),O.querySelector(".error__button").addEventListener("click",(function(){return O.remove()}),{once:!0}),j.addEventListener("keydown",(function e(t){R(t,O,e)}))}function ee(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return te(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}T.addEventListener("change",(function(){V.setAttribute("min",H.getMatchedValue(T.value)),V.setAttribute("placeholder",H.getMatchedValue(T.value))})),V.addEventListener("change",(function(){V.reportValidity()})),P.addEventListener("input",(function(e){e.target.matches("#timein")&&(I.value=M.value),e.target.matches("#timeout")&&(M.value=I.value)})),W.addEventListener("change",J),U.addEventListener("change",J),D.addEventListener("change",(function(e){Q(e.target,z)&&X(e.target,z)})),$.addEventListener("change",(function(e){Q(e.target,F)&&X(e.target,F)})),w(N,$),w(G,D),A.addEventListener("submit",(async function(e){e.preventDefault(),await async function(e,t,r){try{if(!(await fetch("https://23.javascript.htmlacademy.pro/keksobooking",{method:"POST",body:e})).ok)throw new Error;await t()}catch(e){await r()}}(new FormData(A),Y,Z)}));var re=document.querySelector("#card").content.querySelector(".popup");async function ne(e){var t;return await fetch(e,{method:"HEAD",mode:"no-cors"}).then((function(e){t=!!e.ok})),t}function oe(e,t){t?e.textContent=t:e.remove()}function ae(e,t){var r="".concat(e),n=r.match(/[0]+$|[5-9]+$/),o=r.match(/[1]+$/),a=r.match(/[2-4]+$/);return n||e>10&&e<20?t[0]:o?t[1]:a?t[2]:null}async function ie(e,t){var r,n,o=re.cloneNode(!0),a=o.querySelector(".popup__text--price"),i=o.querySelector(".popup__type"),c=o.querySelector(".popup__text--capacity"),u=o.querySelector(".popup__text--time"),l=o.querySelector(".popup__features"),s=o.querySelector(".popup__photos"),f=o.querySelector(".popup__avatar"),d={title:{selector:o.querySelector(".popup__title"),data:e.title},address:{selector:o.querySelector(".popup__text--address"),data:e.address},description:{selector:o.querySelector(".popup__description"),data:e.description}};for(var v in d)Object.hasOwn(d,v)&&oe(d[v].selector,d[v].data);return e.price?a.querySelector("span").previousSibling.replaceData(0,4,e.price):a.remove(),e.checkin&&e.checkout?u.textContent="Заезд после ".concat(e.checkin,", выезд до ").concat(e.checkout):u.remove(),r=e.type,n=i,r?n.textContent={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец",getMatchedType:function(e){if(e)for(var t in this)if(t===e)return this[t];return null}}.getMatchedType(r):n.remove(),function(e,t,r,n){if(e&&t){var o="".concat(e," комнат").concat(ae(e,n.roomWord)),a="".concat(t," гост").concat(ae(t,n.guestWord));r.textContent="".concat(o," для ").concat(a)}else r.remove()}(e.rooms,e.guests,c,{roomWord:["","а","ы"],guestWord:["ей","я","ей"]}),function(e,t){if(e&&0!==e.length){var r,n=ee(t.querySelectorAll(".popup__feature"));try{var o=function(){var n=r.value,o=n.getAttribute("class");void 0===e.find((function(e){return o.includes("popup__feature--".concat(e))}))&&t.removeChild(n)};for(n.s();!(r=n.n()).done;)o()}catch(e){n.e(e)}finally{n.f()}}else t.remove()}(e.features,l),await async function(e,t){if(e&&0!==e.length){var r=t.querySelector(".popup__photo");r.remove(),e.filter((async function(e){await ne(e)})).forEach((function(e,n){var o=r.cloneNode();o.src=e;var a=o.getAttribute("alt");o.setAttribute("alt","".concat(a," ").concat(n)),t.appendChild(o)}))}else t.remove()}(e.photos,s),await async function(e,t){await ne(e)?t.src=e:t.remove()}(t.avatar,f),o}async function ce(e){for(var t=new Map,r=0;r<e.length;r++){var n=await ie(e[r].offer,e[r].author);t.set(e[r].location,n)}return t}var ue=document.querySelector(".map__filters"),le=ue.querySelector("#housing-type"),se=ue.querySelector("#housing-price"),fe=ue.querySelector("#housing-rooms"),de=ue.querySelector("#housing-guests"),ve=ue.querySelector("#housing-features"),pe=ve.querySelectorAll('#housing-features input[type="checkbox"]'),ye=(new Map).set(le,"type").set(se,null).set(fe,"rooms").set(de,"guests"),he=new Set;var me,ge=function(e,t){var r,n=this;return function(){for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];clearTimeout(r),r=setTimeout((function(){return e.apply(n,a)}),t)}}((async function(e,t){var r=e.slice();ye.forEach((function(e,t){"any"!==t.value&&t!==se&&(r=function(e,t,r){return e.filter((function(e){return String(e.offer[t])===r.value}))}(r,e,t)),"any"!==t.value&&t===se&&(r=r.filter((function(e){return t=e.offer.price,"middle"===se.value&&t>=1e4&&t<=5e4||"low"===se.value&&t<1e4||"high"===se.value&&t>5e4?t:null;var t})))})),r=function(e){return pe.forEach((function(e){!0===e.checked?he.add(e.value):he.delete(e.value)})),e.filter((function(e){var t=e.offer.features;return Array.from(he).every((function(e){return!!t&&t.includes(e)}))}))}(r),S(await t(r))}),500);(me=fetch("https://23.javascript.htmlacademy.pro/keksobooking/data").then((function(e){if(e.ok)return e.json();throw new Error("Ошибка загрузки данных с сервера. Попробуйте перезагрузить страницу.")})).catch((function(e){return function(e){var t=document.querySelector("body"),r=document.createElement("div");r.classList.add("error","error_data"),r.textContent=e,t.append(r)}(e)})),me).then((function(e){var t;return t=function(){return ge(e,ce)},le.addEventListener("input",t),se.addEventListener("input",t),fe.addEventListener("input",t),de.addEventListener("input",t),ve.addEventListener("input",t),ce(e)})).then((function(e){return S(e)})).then(function(){d.classList.remove("map__filters--disabled");var e,t=a(d.children);try{for(t.s();!(e=t.n()).done;){e.value.removeAttribute("disabled","")}}catch(e){t.e(e)}finally{t.f()}}())}},function(e){e.O(0,[344],(function(){return t=148,e(e.s=t);var t}));e.O()}]);
